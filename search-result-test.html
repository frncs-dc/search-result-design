<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Search test</title>
    <link rel="stylesheet" type="text/css" href="search-stylesheet.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body class="p-2 d-flex flex-column">
    
    <div class="search-bar d-flex flex-row mb-3">
        <div class="rounded-5 border w-75 ps-3 py-2 mb-2">Pogi Si Leeroi</div>
        <button type="submit">Search</button>
    </div>
    <div class="results-container border d-flex flex-column flex-grow-1"></div>
        <button id="downloadData">Download Data</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        let currentIndex = 0;
        let screens = 0;
        let data = {
            
            "results": [
                {
                "id": 1,
                "image": "https://imgur.com/E2SfsZk.jpg",
                "title": "Why Did The Chicken Cross The Road?",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Crossed The Roads | Animal Crossing Mobile Game Ad", "content": "Why did the chicken cross the road? To get to the highest score! Top Free Mobile Game. Cross the roads and compete to get high scores among your online…"},
                    "list": {"type": "list", "title": "WHEN Did The Chicken Cross The Road? | History of Jokes", "items": ["One of the most famous examples of anti-humor", "First appeared on The Knickerbocker in 1847", "Has since evolved to include other animals other than chickens"]},
                    "tab": {
                    "title": "Top 30 Crossing Roads Jokes",
                    "type": "tab",
                    "tabs": [
                        {"title": "Tab 1", "content": "Q1: Why did the chicken cross the road? A: To prove it wasn’t a chicken cross."},
                        {"title": "Tab 2", "content": "Q2: Why did the chicken cross the road? A: To maintain 1 feet of social distancing."},
                        {"title": "Tab 3", "content": "Q3: Why did the chicken cross the road? A: To get to the other side!"}
                    ]
                    }
                }
                },
                {
                "id": 2,
                "image": "https://imgur.com/zx6bDq6.jpg",
                "title": "Professor Cramming Meme",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Based Cruz: If you think you’re good at cramming, my professor… | Tweeter", "content": "Join the conversation on Tweeter as users share anecdotes and memes about their experiences with professors mastering the art of last-minute preparation."},
                    "list": {"type": "list", "title": "This Professor Cramming His Presentation in a Conference is…", "items": ["A picture of a professor hastily preparing for a conference presentation", "In a Human-Computer Interaction Conference", "Trending in sites such as Readit and Tweeter"]},
                    "tab": {
                    "title": "Who’s That Meme | Professor Cramming Meme",
                    "type": "tab",
                    "tabs": [
                        {"title": "Tab 1", "content": "Professor Cramming Meme: Explore the origin and spread of the Professor Cramming meme, a hilarious depiction of academic stress and last-minute preparation."},
                        {"title": "Tab 2", "content": "Professor Cying Meme: Explore the origin and spread of the Professor Crying meme, a hilariously dark meme that shows the reality of teaching."},
                        {"title": "Tab 3", "content": "Professor Sleeping Meme: Explore the origin and spread of the Professor Sleeping meme, a depiction of overworked and stressed professors."}
                    ]
                    }
                }
                },
                {
                "id": 3,
                "image": "https://imgur.com/rh4t1Xz.jpg",
                "title": "KPOP Photocards",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Exploring the Craze: What Makes KPOP Photocards So Valuable?", "content": "Delve into the phenomenon behind the skyrocketing prices of KPOP photocards and the fervent fan culture driving the market to new heights."},
                    "list": {"type": "list", "title": "BTX Photocards Dominate the List of Most Expensive KPOP Collectibles", "items": ["Dive into the world of KPOP merchandise where BTX photocards reign supreme", "Limited edition photocards range from 500$ to 1000$", "They can be found through albums, events, raffles"]},
                    "tab": {
                    "title": "Top 10 Most Expensive KPOP Photocards Ever Sold",
                    "type": "tab",
                    "tabs": [
                        {"title": "Tab 1", "content": "Number 1: BTX’s Jung Kim  – Butterfly Night is the most sought-after photocard due to its limited printing and the group’s rise to fame."},
                        {"title": "Tab 2", "content": "Number 2: Two Times - Cheery Above is highly sought after as this is a photocard from their early these before becoming the nation’s girl group"},
                        {"title": "Tab 3", "content": "Number 3: TvT’s YenJun - Purple Seconds photocard is south after for its unique printing error that made it look even better than its original."}
                    ]
                    }
                }
                },
                {
                "id": 4,
                "image": "https://imgur.com/tnu9Lyh.jpg",
                "title": "Intramuros",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Intramuros Insider's Guide: Best Spots for History Buffs and Photography Enthusiasts", "content": "From ancient fortifications to picturesque gardens, explore the top spots within Intramuros that showcase the beauty and charm of Manila's storied past."},
                    "list": {"type": "list", "title": "Hidden Gems of Intramuros: Uncovering Secret Spots in Manila's Historic District", "items": ["Nakatagong Museo, Dimakita Cafe, Sanmahanap Park", "A glimpse into Manila's colonial past.", "Venture off the beaten path and discover the lesser-known treasures nestled within the walls of Intramuros"]},
                    "tab": {
                    "title": "Exploring the Wonders of Intramuros: Top Spots to Visit",
                    "type": "tab",
                    "tabs": [
                        {"title": "Tab 1", "content": "Rizal Park: A sprawling green space with historical significance, offering serene surroundings and iconic monuments."},
                        {"title": "Tab 2", "content": "Intramuros Museum: Dive into the rich history of Intramuros through exhibits showcasing artifacts and relics from the Spanish colonial era."},
                        {"title": "Tab 3", "content": "San Agustin Church: A UNESCO World Heritage Site, renowned for its stunning architecture and centuries-old religious artifacts."}
                    ]
                    }
                }
                },
                {
                "id": 5,
                "image": "https://imgur.com/rK5bkGu.jpg",
                "title": "French Revolution",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "From Monarchy to Republic: The French Revolution in Retrospect", "content": "Trace the revolutionary journey of France from monarchy to republic, analyzing the pivotal moments and ideological shifts that shaped modern Europe."},
                    "list": {"type": "list", "title": "Lessons from the Past: The Legacy of the French Revolution", "items": ["Ideals of Liberty and Freedom, born from the French Revolution, persist as core principles in today's societies.", "Struggles for Equality and the Needs of the Masses, ignited by the revolution's demand for social justice, shape contemporary movements and policies.", "The Quest for Justice, a central theme of the revolution, remains pivotal in modern governance and law enforcement."]},
                    "tab": {
                    "title": "Unraveling the French Revolution: A Turning Point in History",
                    "type": "tab",
                    "tabs": [
                        {"title": "Tab 1", "content": "Storming of the Bastille: Symbolizing the beginning of the revolution, this event marked the uprising against the monarchy and the quest for liberty."},
                        {"title": "Tab 2", "content": "Reign of Terror: Characterized by political executions and mass violence, this period reflects the radical phase of the revolution led by figures like Robespierre."},
                        {"title": "Tab 3", "content": "Rise of Napoleon Bonaparte: Culminating in the establishment of the French Consulate and later the Napoleonic Empire, Napoleon's ascent to power reshaped Europe's political landscape."}
                    ]
                    }
                }
                }
            ]
        };
        let clickCounters = {}; // Counters object for keeping track of clicks
        let prevPicturePresence = [null, null, null]; // Initial picture presence for paragraph, list, tab
        let timeCounters = {};
        
        function displayData() {
            // Clear the container
            const container = document.querySelector('.results-container');
            container.innerHTML = '';
    
            // Get the data at the current index
            const result = data.results[currentIndex];

            // Select one paragraph
            const paragraph = result.description.paragraph;
            const p = document.createElement('div');
            p.textContent = paragraph.content;
    
            // Create a ul for the list
            const ulList = document.createElement('ul');
            // Iterate over all list items
            result.description.list.items.forEach(listItem => {
                const liList = document.createElement('li');
                liList.textContent = listItem;
                ulList.appendChild(liList);
            });
    
            // Create a div for the tabs and tab content
            const divTab = document.createElement('div');

            // Create the list of tabs
            const ulTab = document.createElement('ul');
            ulTab.className = 'nav nav-tabs';
            ulTab.id = 'myTab';
            ulTab.role = 'tablist';

            // Create the div for the tab content
            const divTabContent = document.createElement('div');
            divTabContent.className = 'tab-content';

            // Iterate over all tabs
            result.description.tab.tabs.forEach((tab, index) => {
                // Create the tab
                const liTab = document.createElement('li');
                liTab.className = 'nav-item';
                liTab.role = 'presentation';
                const aTab = document.createElement('a');
                aTab.className = 'nav-link' + (index === 0 ? ' active' : '');
                aTab.id = 'tab-' + index;
                aTab.setAttribute('data-bs-toggle', 'tab');
                aTab.href = '#content-' + index;
                aTab.role = 'tab';
                aTab.textContent = tab.title;
                liTab.appendChild(aTab);
                ulTab.appendChild(liTab);

                // Create the tab content
                const divTabPane = document.createElement('div');
                divTabPane.className = 'tab-pane fade' + (index === 0 ? ' show active' : '');
                divTabPane.id = 'content-' + index;
                divTabPane.role = 'tabpanel';
                divTabPane.setAttribute('aria-labelledby', 'tab-' + index);

                const pTabContent = document.createElement('p');
                pTabContent.textContent = tab.content;
                divTabPane.appendChild(pTabContent);

                divTabContent.appendChild(divTabPane);
            });

            divTab.appendChild(ulTab);
            divTab.appendChild(divTabContent);
        
            // Create sections for paragraph, list, and tab
            const sections = [p, ulList, divTab,];
            const descriptionTypes = [paragraph.title, result.description.list.title, result.description.tab.title];
            const actualDescriptionTypes = [paragraph.type, result.description.list.type, result.description.tab.type]
            sections.forEach((section, index) => {
                const div = document.createElement('div');
                div.className = 'card p-3 search-container border mb-2';

                const h3 = document.createElement('h3');
                const a = document.createElement('a');
                a.className = 'search-title';
                a.href = '#';
                a.textContent = descriptionTypes[index]; // Set the title according to the description type

                h3.appendChild(a);
                div.appendChild(h3);
                div.appendChild(section);

                // Randomize the picture presence for the first set, then complement it for the next set
                if (prevPicturePresence[index] === null) {
                    if (Math.random() < 0.5) {
                        appendPicture(div, result.image);
                        prevPicturePresence[index] = true;
                    } else {
                        prevPicturePresence[index] = false;
                    }
                } else if (prevPicturePresence[index]) {
                    prevPicturePresence[index] = false;
                } else {
                    appendPicture(div, result.image);
                    prevPicturePresence[index] = true;
                }

                container.appendChild(div);
            });

            let loadTime = performance.now();
            

            // When the anchor is clicked, display the next data
            const anchors = document.querySelectorAll('.search-title');

            anchors.forEach((anchor, index) => {
                anchor.addEventListener('click', (event) => {
                    if (screens >= 10) {
                        console.log('Reached 10 screens, ending experiment.');
                        showData()
                        return;
                    }
                    event.preventDefault();
                    currentIndex = (currentIndex + 1) % data.results.length;
                    displayData();
            
                    // Get the result id and description type
                    const resultId = data.results[currentIndex].id;
                    const actualDescriptionType = actualDescriptionTypes[index];
                    const photoPresence = !prevPicturePresence[index];
            
                    // Create a key for the counters object
                    //key1 is for each specific topic's result layout combination
                    const key = `${resultId}-${actualDescriptionType}-${photoPresence}`;
                    //key2 is for each result layout combination, regardless of topic
                    const key2 = `${actualDescriptionType}-${photoPresence}`;
                    //key2 is for each description type, regardless of photo presence and topic
                    const key3 = `${actualDescriptionType}`;
                    //key2 is for the photo presence, regardless of topic and description type
                    const key4 = `${photoPresence}`;
            
                    // If the counter for this key doesn't exist yet, initialize it
                    if (!clickCounters[key]) {
                        clickCounters[key] = 0;
                    }
                    if (!clickCounters[key2]) {
                        clickCounters[key2] = 0;
                    }
                    if (!clickCounters[key3]) {
                        clickCounters[key3] = 0;
                    }
                    if (!clickCounters[key4]) {
                        clickCounters[key4] = 0;
                    }
            
                    // Increment the counter for the keys
                    clickCounters[key]++;
                    clickCounters[key2]++;
                    clickCounters[key3]++;
                    clickCounters[key4]++;
            
                    console.log(`Click count for ${key}: ${clickCounters[key]}`); // Log the current count
                    console.log(`Click count for ${key2}: ${clickCounters[key2]}`);
                    console.log(`Click count for ${key3}: ${clickCounters[key3]}`);
                    console.log(`Click count for ${key4}: ${clickCounters[key4]}`);
                    screens++;

                    // Calculate the time taken
                    let clickTime = performance.now();
                    let timeTaken = clickTime - loadTime;

                    // Create a key for the counters object
                    const tkey = `${resultId}-${actualDescriptionType}-${photoPresence}`;
                    const tkey2 = `${actualDescriptionType}-${photoPresence}`;
                    const tkey3 = `${actualDescriptionType}`;
                    const tkey4 = `${photoPresence}`;

                    // If the counter for this key doesn't exist yet, initialize it
                    if (!timeCounters[tkey]) {
                        timeCounters[tkey] = 0;
                    }
                    if (!timeCounters[tkey2]) {
                        timeCounters[tkey2] = 0;
                    }
                    if (!timeCounters[tkey3]) {
                        timeCounters[tkey3] = 0;
                    }
                    if (!timeCounters[tkey4]) {
                        timeCounters[tkey4] = 0;
                    }

                    // Add the time taken to the counterst
                    timeCounters[tkey] += timeTaken;
                    timeCounters[tkey2] += timeTaken;
                    timeCounters[tkey3] += timeTaken;
                    timeCounters[tkey4] += timeTaken;

                    // Log the current time taken
                    console.log(`Time taken for ${tkey}: ${timeCounters[tkey]} ms`);
                    console.log(`Time taken for ${tkey2}: ${timeCounters[tkey2]} ms`);
                    console.log(`Time taken for ${tkey3}: ${timeCounters[tkey3]} ms`);
                    console.log(`Time taken for ${tkey4}: ${timeCounters[tkey4]} ms`);
                    // Reset the load time
                    loadTime = performance.now();
                });
            });

            // Initialize Bootstrap tabs
            var tabList = document.querySelectorAll('[data-bs-toggle="tab"]');
            var tabListArray = [].slice.call(tabList);
            tabListArray.map(function (tab) {
                return new bootstrap.Tab(tab);
            });
      
        }
    
        // Function to append picture to a div
        function appendPicture(div, imageSrc) {
            let img = document.createElement('img');
            img.src = imageSrc;
            img.className = 'rounded ms-auto d-block img-fluid desc-pic';
            div.appendChild(img);
        }
        document.getElementById('downloadData').addEventListener('click', () => {
            // Convert the data to CSV
            let csv = 'data:text/csv;charset=utf-8,';
            csv += Object.keys(clickCounters).join(',') + '\n';
            csv += Object.values(clickCounters).join(',') + '\n';
            csv += Object.keys(timeCounters).join(',') + '\n';
            csv += Object.values(timeCounters).join(',') + '\n';

            // Create a link and download the CSV
            const encodedUri = encodeURI(csv);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'data.csv');
            document.body.appendChild(link);
            link.click();
        });
        data.results.sort(() => Math.random() - 0.5);
        displayData();
    
        // // Fetch data from JSON file
        // fetch('../sample.json')
        // .then(response => response.json())
        // .then(fetchedData => {
        //     data = fetchedData;
        //     // Randomize the order of results
        //     data.results.sort(() => Math.random() - 0.5);
        //     // Initially display the first data
        //     displayData();
        // })
        // .catch(error => console.error('Error:', error));

        // Add function to show data after 10 screens
        function showData() {
            console.log(clickCounters);
            // Create sections for the data, in descending order of clicks
            const sections = [p, ulList, divTab,];
            for (let key in clickCounters) {
                const [resultId, descriptionType, photoPresence] = key.split('-');
                const result = data.results.find(result => result.id === resultId);
                const section = sections.find((section, index) => actualDescriptionTypes[index] === descriptionType);
                if (clickCounters[key] > 0) {
                    appendSection(result, section);
                }
            }

            // Code below comes from the displayData function, not yet properly refactored
            /*
            sections.forEach((section, index) => {
                const div = document.createElement('div');
                div.className = 'card p-3 search-container border mb-2';

                const h3 = document.createElement('h3');
                const a = document.createElement('a');
                a.className = 'search-title';
                a.href = '#';
                a.textContent = descriptionTypes[index]; // Set the title according to the description type

                h3.appendChild(a);
                div.appendChild(h3);
                div.appendChild(section);

                // Randomize the picture presence for the first set, then complement it for the next set
                if (prevPicturePresence[index] === null) {
                    if (Math.random() < 0.5) {
                        appendPicture(div, result.image);
                        prevPicturePresence[index] = true;
                    } else {
                        prevPicturePresence[index] = false;
                    }
                } else if (prevPicturePresence[index]) {
                    prevPicturePresence[index] = false;
                } else {
                    appendPicture(div, result.image);
                    prevPicturePresence[index] = true;
                }

                container.appendChild(div);
            });
            */
        }   
    </script>
    </body>
</html>