<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Search test</title>
    <link rel="stylesheet" type="text/css" href="search-stylesheet.css">
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body class="p-2 d-flex flex-column">
    <!-- Search bar -->
    <div class="search-bar d-flex flex-row mb-3">
        <div id="search-result-title" class="rounded-5 border w-75 ps-3 py-2 mb-2"></div>
        <button type="submit" class="border-0 rounded-5 px-4 ms-3">Search</button>
    </div>
    <div class="row d-flex flex-row">
        <!-- Results container -->
        <div class="results-container col col-8 border d-flex flex-column flex-grow-1">
            <!-- Results will be displayed here -->
        </div>
        <div class="col col-3 border">
            <!-- Blank space to simulate the right side content of Bing search engine -->
        </div>
    </div>
    <!-- Bootstrap JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // JSON data
        let data = {
            
            "results": [
                {
                "id": 1,
                "image": "https://imgur.com/E2SfsZk.jpg",
                "title": "Why Did The Chicken Cross The Road?",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Crossed The Roads | Animal Crossing Mobile Game Ad", "content": "Why did the chicken cross the road? To get to the highest score! Top Free Mobile Game. Cross the roads and compete to get high scores among your online…"},
                    "list": {"type": "list", "title": "WHEN Did The Chicken Cross The Road? | History of Jokes", "items": ["One of the most famous examples of anti-humor", "First appeared on The Knickerbocker in 1847", "Has since evolved to include other animals other than chickens"]},
                    "tab": {
                    "title": "Top 30 Crossing Roads Jokes",
                    "type": "tab",
                    "tabs": [
                        {"title": "Example Joke", "content": "Q1: Why did the chicken cross the road? A: To prove it wasn’t a chicken cross."},
                        {"title": "Timely Joke", "content": "Q2: Why did the chicken cross the road? A: To maintain 1 feet of social distancing."},
                        {"title": "Original Joke", "content": "Q3: Why did the chicken cross the road? A: To get to the other side!"}
                    ]
                    }
                }
                },
                {
                "id": 2,
                "image": "https://imgur.com/zx6bDq6.jpg",
                "title": "Professor Cramming Meme",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Based Cruz: If you think you’re good at cramming, my professor… | Tweeter", "content": "Join the conversation on Tweeter as users share anecdotes and memes about their experiences with professors mastering the art of last-minute preparation."},
                    "list": {"type": "list", "title": "This Professor Cramming His Presentation in a Conference is…", "items": ["A picture of a professor hastily preparing for a conference presentation", "In a Human-Computer Interaction Conference", "Trending in sites such as Readit and Tweeter"]},
                    "tab": {
                    "title": "Who’s That Meme | Professor Cramming Meme",
                    "type": "tab",
                    "tabs": [
                        {"title": "Professor Cramming Meme", "content": "Professor Cramming Meme: Explore the origin and spread of the Professor Cramming meme, a hilarious depiction of academic stress and last-minute preparation."},
                        {"title": "Professor Crying Meme", "content": "Professor Crying Meme: Explore the origin and spread of the Professor Crying meme, a hilariously dark meme that shows the reality of teaching."},
                        {"title": "Professor Sleeping Meme", "content": "Professor Sleeping Meme: Explore the origin and spread of the Professor Sleeping meme, a depiction of overworked and stressed professors."}
                    ]
                    }
                }
                },
                {
                "id": 3,
                "image": "https://imgur.com/rh4t1Xz.jpg",
                "title": "KPOP Photocards",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Exploring the Craze: What Makes KPOP Photocards So Valuable?", "content": "Delve into the phenomenon behind the skyrocketing prices of KPOP photocards and the fervent fan culture driving the market to new heights."},
                    "list": {"type": "list", "title": "BTX Photocards Dominate the List of Most Expensive KPOP Collectibles", "items": ["Dive into the world of KPOP merchandise where BTX photocards reign supreme", "Limited edition photocards range from 500$ to 1000$", "They can be found through albums, events, raffles"]},
                    "tab": {
                    "title": "Top 10 Most Expensive KPOP Photocards Ever Sold",
                    "type": "tab",
                    "tabs": [
                        {"title": "BTX Jung Kim - Butterfly Night", "content": "Number 1: BTX’s Jung Kim  – Butterfly Night is the most sought-after photocard due to its limited printing and the group’s rise to fame."},
                        {"title": "Two Times - Cheery Above", "content": "Number 2: Two Times - Cheery Above is highly sought after as this is a photocard from their early these before becoming the nation’s girl group"},
                        {"title": "TvT YenJun - Purple Seconds", "content": "Number 3: TvT’s YenJun - Purple Seconds photocard is south after for its unique printing error that made it look even better than its original."}
                    ]
                    }
                }
                },
                {
                "id": 4,
                "image": "https://imgur.com/tnu9Lyh.jpg",
                "title": "Intramuros",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "Intramuros Insider's Guide: Best Spots for History Buffs and Photography Enthusiasts", "content": "From ancient fortifications to picturesque gardens, explore the top spots within Intramuros that showcase the beauty and charm of Manila's storied past."},
                    "list": {"type": "list", "title": "Hidden Gems of Intramuros: Uncovering Secret Spots in Manila's Historic District", "items": ["Nakatagong Museo, Dimakita Cafe, Sanmahanap Park", "A glimpse into Manila's colonial past.", "Venture off the beaten path and discover the lesser-known treasures nestled within the walls of Intramuros"]},
                    "tab": {
                    "title": "Exploring the Wonders of Intramuros: Top Spots to Visit",
                    "type": "tab",
                    "tabs": [
                        {"title": "Rizal Park", "content": "Rizal Park: A sprawling green space with historical significance, offering serene surroundings and iconic monuments."},
                        {"title": "Intramuros Museum", "content": "Intramuros Museum: Dive into the rich history of Intramuros through exhibits showcasing artifacts and relics from the Spanish colonial era."},
                        {"title": "San Agustin", "content": "San Agustin Church: A UNESCO World Heritage Site, renowned for its stunning architecture and centuries-old religious artifacts."}
                    ]
                    }
                }
                },
                {
                "id": 5,
                "image": "https://imgur.com/rK5bkGu.jpg",
                "title": "French Revolution",
                "description": {
                    "paragraph": {"type": "paragraph", "title": "From Monarchy to Republic: The French Revolution in Retrospect", "content": "Trace the revolutionary journey of France from monarchy to republic, analyzing the pivotal moments and ideological shifts that shaped modern Europe."},
                    "list": {"type": "list", "title": "Lessons from the Past: The Legacy of the French Revolution", "items": ["Ideals of Liberty and Freedom, born from the French Revolution, persist as core principles in today's societies.", "Struggles for Equality and the Needs of the Masses, ignited by the revolution's demand for social justice, shape contemporary movements and policies.", "The Quest for Justice, a central theme of the revolution, remains pivotal in modern governance and law enforcement."]},
                    "tab": {
                    "title": "Unraveling the French Revolution: A Turning Point in History",
                    "type": "tab",
                    "tabs": [
                        {"title": "Storming of the Bastille", "content": "Storming of the Bastille: Symbolizing the beginning of the revolution, this event marked the uprising against the monarchy and the quest for liberty."},
                        {"title": "Reign of Terror", "content": "Reign of Terror: Characterized by political executions and mass violence, this period reflects the radical phase of the revolution led by figures like Robespierre."},
                        {"title": "Rise of Napoleon Bonaparte", "content": "Rise of Napoleon Bonaparte: Culminating in the establishment of the French Consulate and later the Napoleonic Empire, Napoleon's ascent to power reshaped Europe's political landscape."}
                    ]
                    }
                }
                }
            ]
        };
        // Initialize variables
        let currentIndex = 0;
        let screens = 0;

        // Counters object for keeping track of clicks
        let clickCounters = {};
        let clickCounters2 = {};
        let clickCounters3 = {};
        let clickCounters4 = {};
        let clickCounters5 = {};
        let clickCounters6= {};
        let clickCounters7 = {};
        let clickCountersFirstTime = {};
        let clickCounters2FirstTime = {};
        let clickCounters3FirstTime= {};
        let clickCounters4FirstTime = {};
        let clickCounters5FirstTime = {};
        let clickCounters6FirstTime= {};
        let clickCounters7FirstTime = {};
        let clickCountersSecondTime = {};
        let clickCounters2SecondTime = {};
        let clickCounters3SecondTime= {};
        let clickCounters4SecondTime = {};
        let clickCounters5SecondTime = {};
        let clickCounters6SecondTime= {};
        let clickCounters7SecondTime = {};
        // Counters object for keeping track of time taken after loading and before clicking
        let timeCounters = {};
        let timeCounters2 = {};
        let timeCounters3 = {};
        let timeCounters4 = {};
        let timeCounters5 = {};
        let timeCounters6= {};
        let timeCounters7 = {};
        let timeCountersFirstTime = {};
        let timeCounters2FirstTime = {};
        let timeCounters3FirstTime= {};
        let timeCounters4FirstTime = {};
        let timeCounters5FirstTime = {};
        let timeCounters6FirstTime= {};
        let timeCounters7FirstTime = {};
        let timeCountersSecondTime = {};
        let timeCounters2SecondTime = {};
        let timeCounters3SecondTime= {};
        let timeCounters4SecondTime = {};
        let timeCounters5SecondTime = {};
        let timeCounters6SecondTime= {};
        let timeCounters7SecondTime = {};

        let prevPicturePresence = [null, null, null]; // Initial picture presence for paragraph, list, tab
        
        function displayData() {
            // Clear the container; effectively removes the button
            const container = document.querySelector('.results-container');
            container.innerHTML = '';
    
            // Get the data at the current index of results
            const result = data.results[currentIndex];

            // Get the search result title element
            const searchResultTitle = document.getElementById('search-result-title');

            // Set the title of the search result
            searchResultTitle.textContent = result.title;

            // description here accesses object of descriptions (paragraph, list, tab)
            // Select one paragraph
            const paragraph = result.description.paragraph;
            const p = document.createElement('div');
            p.className = "col-9";
            // Sets the contents of the paragraph;
            // content is the actual text of the paragraph
            p.textContent = paragraph.content;
    
            // Create a ul for the list
            const ulList = document.createElement('ul');
            ulList.className = "col-9";
            // Iterate over all list "items" attribute
            result.description.list.items.forEach(listItem => {
                const liList = document.createElement('li');
                // Sets the contents of the list;
                // content is the actual text of the list
                liList.textContent = listItem;
                // append the list item to the unordered list
                // append is basically adding the list item to the unordered list
                // ex:
                // <ul>
                //     <li>listItem</li>
                //     <li>listItem</li>
                //     <li>listItem</li>
                // </ul>
                ulList.appendChild(liList);
            });
    
            // Create a div for the tabs and tab contents
            const divTab = document.createElement('div');
            // Create the list of tabs
            const ulTab = document.createElement('ul');
            // Doing this essentially assigns a bootstrap class to the unordered list ulTab
            // These are just styles
            ulTab.className = 'nav nav-tabs';
            // Create the div for the tab content
            const divTabContent = document.createElement('div');
            divTabContent.className = 'tab-content col-9';
            // Iterate over all tabs
            result.description.tab.tabs.forEach((tab, index) => {
                // Create the tab
                const liTab = document.createElement('li');
                // Bootstrap class for the list item
                liTab.className = 'nav-item';
                const aTab = document.createElement('a');
                // Bootstrap class for the anchor and 
                // checks if index is equal to 0. If index is 0, it returns the string ' active'.
                // If index is not 0, it returns an empty string ''.
                // This sets the first tab as active
                aTab.className = 'nav-link' + (index === 0 ? ' active' : '');
                aTab.setAttribute('data-bs-toggle', 'tab');
                // This sets the href of the anchor.
                aTab.href = '#content-' + index;
                aTab.id = 'tab-' + index;
                // This sets the text of the anchor for tab to the title of the tab.
                aTab.textContent = tab.title;
                liTab.appendChild(aTab);
                ulTab.appendChild(liTab);
                // Create the tab content
                const divTabPane = document.createElement('div');
                // This sets the class of the div for the Tab. If index is 0, it essentially
                // shows the contents, otherwise, it doesn't.
                divTabPane.className = 'tab-pane fade' + (index === 0 ? ' show active' : '');
                divTabPane.id = 'content-' + index;

                divTabPane.setAttribute('aria-labelledby', 'tab-' + index);
                const pTabContent = document.createElement('p');

                pTabContent.textContent = tab.content;
                divTabPane.appendChild(pTabContent);
                divTabContent.appendChild(divTabPane);
                // ex:
                // <div id="divTabContent">
                //     <div id="divTabPane">
                //         <p id="pTabContent">
                //         <!-- tab.content -->
                //         </p>
                //     </div>
                // </div>
            });

            // Adds the unordered list to the main div (container) for tabs
            divTab.appendChild(ulTab);
            divTab.appendChild(divTabContent);
        
            // Array of the sections; contains the paragraph, list, and tab
            const sections = [p, ulList, divTab];
            const descriptionTitles = [paragraph.title, result.description.list.title, result.description.tab.title];
            const descriptionTypes = [paragraph.type, result.description.list.type, result.description.tab.type]
            
            // Create an array of objects, where each object contains a section and its corresponding description type
            const sectionObjects = sections.map((section, index) => {
                return { section: section, descriptionType: descriptionTypes[index] };
            });

            // Shuffle the array of objects
            shuffle(sectionObjects);

            // Extract the shuffled sections and description types from the array of objects
            const shuffledSections = sectionObjects.map(object => object.section);
            const shuffledDescriptionTypes = sectionObjects.map(object => object.descriptionType);

            shuffledSections.forEach((section, index) => {
                const div = document.createElement('div');
                div.className = 'card p-3 search-container border mb-2 w-auto';

                // Create a new div to act as a flex container for the anchor, paragraph, and image
                const flexDiv = document.createElement('div');
                flexDiv.style.display = 'flex';
                flexDiv.style.alignItems = 'flex-start'; // Align items vertically in the center

                // Create a new div to contain the anchor and paragraph
                const contentDiv = document.createElement('div');

                const h3 = document.createElement('h3');
                const a = document.createElement('a');
                a.className = 'search-title';
                a.href = '#';
                a.textContent = descriptionTitles[sections.indexOf(shuffledSections[index])]; // Set the title according to the description type // Set the title according to the description type

                h3.appendChild(a);
                contentDiv.appendChild(h3); // Append the anchor to the content div
                contentDiv.appendChild(section); // Append the section to the content div
                
                flexDiv.appendChild(contentDiv); // Append the content div to the flex container

                shuffledDescriptionTypes.forEach((descriptionType, index) => {
                    // Randomize the picture presence for the first set, then complement it for the next set
                    if (prevPicturePresence[index] === null) {
                        if (Math.random() < 0.5) {
                            appendPicture(flexDiv, result.image);
                            prevPicturePresence[index] = true;
                        } else {
                            prevPicturePresence[index] = false;
                        }
                    } else if (prevPicturePresence[index]) {
                        prevPicturePresence[index] = false;
                    } else {
                        appendPicture(flexDiv, result.image);
                        prevPicturePresence[index] = true;
                    }
                });
                // // Randomize the picture presence for the first set, then complement it for the next set
                // if (prevPicturePresence[index] === null) {
                //     if (Math.random() < 0.5) {
                //         appendPicture(flexDiv, result.image);
                //         prevPicturePresence[index] = true;
                //     } else {
                //         prevPicturePresence[index] = false;
                //     }
                // } else if (prevPicturePresence[index]) {
                //     prevPicturePresence[index] = false;
                // } else {
                //     appendPicture(flexDiv, result.image);
                //     prevPicturePresence[index] = true;
                // }

                div.appendChild(flexDiv); // Append the flex container to the main div
                container.appendChild(div);
            });

            // 
            let loadTime = performance.now();
            let firstTime = true;

            // When the anchor is clicked, display the next data
            const anchors = document.querySelectorAll('.search-title');

            anchors.forEach((anchor, index) => {
                anchor.addEventListener('click', (event) => {
                    event.preventDefault();
                    currentIndex = (currentIndex + 1) % data.results.length;
                    displayData();

                    // if (repeat == 0), do calculations for the first time SET 1 & SET 2 was shown to user
                    // Get the result id and description type
                    const searchQueryTopic = data.results[currentIndex].title;
                    const descriptionTypes = shuffledDescriptionTypes[index];
                    const photoPresence = !prevPicturePresence[index];
                    const photoPresenceSimple = photoPresence ? 'pic' : 'noPic'; // converts TRUE and FALSE with 'pic' and 'noPic' respectively

                    // KNOWN ISSUE: There is a bug where the first time and second time are not being calculated correctly.
                        // Screen 11, despite being "secondTime", is becoming part of "firstTime".
                    if (screens < 10){
                        firstTime = true
                    } else if (screens >= 10 && screens < 20) {
                        firstTime = false
                    }
                    console.log(firstTime)
                    let firstTimeSimple = firstTime ? 'first' : 'second'; // converts TRUE and FALSE with 'first' and 'second' respectively
                    console.log(firstTimeSimple)
            
                    // Create a key for the counters object
                    //key1 is for each specific topic's result layout combination (taking into account whether it's the first time or second time seeing the layout)
                    const key = `${searchQueryTopic}-${descriptionTypes}-${photoPresenceSimple}-${firstTimeSimple}`;
                    //key2 is for each specific topic's result layout combination
                    const key2 = `${searchQueryTopic}-${descriptionTypes}-${photoPresenceSimple}`;
                    //key3 is for each result layout combination, regardless of topic  (taking into account whether it's the first time or second time seeing the layout)
                    const key3 = `${descriptionTypes}-${photoPresenceSimple}-${firstTimeSimple}`;
                    //key4 is for each result layout combination, regardless of topic
                    const key4 = `${descriptionTypes}-${photoPresenceSimple}`;
                    //key5 is for each description type, regardless of photo presence and topic  (taking into account whether it's the first time or second time seeing the layout)
                    const key5 = `${descriptionTypes}-${firstTimeSimple}`;
                    //key6 is for each description type, regardless of photo presence and topic
                    const key6 = `${descriptionTypes}`; 
                    //key7 is for the photo presence, regardless of topic and description type
                    const key7 = `${photoPresenceSimple}`;
                    
                    // If the counter for this key doesn't exist yet, initialize it
                    if (screens < 10){
                        if (!clickCountersFirstTime[key]) {
                            clickCountersFirstTime[key] = 0;
                        }
                        if (!clickCounters2FirstTime[key2]) {
                            clickCounters2FirstTime[key2] = 0;
                        }
                        if (!clickCounters3FirstTime[key3]) {
                            clickCounters3FirstTime[key3] = 0;
                        }
                        if (!clickCounters4FirstTime[key4]) {
                            clickCounters4FirstTime[key4] = 0;
                        }
                        if (!clickCounters5FirstTime[key5]) {
                            clickCounters5FirstTime[key5] = 0;
                        }
                        if (!clickCounters6FirstTime[key6]) {
                            clickCounters6FirstTime[key6] = 0;
                        }
                        if (!clickCounters7FirstTime[key7]) {
                            clickCounters7FirstTime[key7] = 0;
                        }
                        clickCountersFirstTime[key]++;
                        clickCounters2FirstTime[key2]++;
                        clickCounters3FirstTime[key3]++;
                        clickCounters4FirstTime[key4]++;
                        clickCounters5FirstTime[key5]++;
                        clickCounters6FirstTime[key6]++;
                        clickCounters7FirstTime[key7]++;

                        if (!clickCounters[key]) {
                            clickCounters[key] = 0;
                        }
                        if (!clickCounters2[key2]) {
                            clickCounters2[key2] = 0;
                        }
                        if (!clickCounters3[key3]) {
                            clickCounters3[key3] = 0;
                        }
                        if (!clickCounters4[key4]) {
                            clickCounters4[key4] = 0;
                        }
                        if (!clickCounters5[key5]) {
                            clickCounters5[key5] = 0;
                        }
                        if (!clickCounters6[key6]) {
                            clickCounters6[key6] = 0;
                        }
                        if (!clickCounters7[key7]) {
                            clickCounters7[key7] = 0;
                        }
                        clickCounters[key]++;
                        clickCounters2[key2]++;
                        clickCounters3[key3]++;
                        clickCounters4[key4]++;
                        clickCounters5[key5]++;
                        clickCounters6[key6]++;
                        clickCounters7[key7]++;
                    } if (screens >= 10 && screens < 20) {
                        if (!clickCountersSecondTime[key]) {
                            clickCountersSecondTime[key] = 0;
                        }
                        if (!clickCounters2SecondTime[key2]) {
                            clickCounters2SecondTime[key2] = 0;
                        }
                        if (!clickCounters3SecondTime[key3]) {
                            clickCounters3SecondTime[key3] = 0;
                        }
                        if (!clickCounters4SecondTime[key4]) {
                            clickCounters4SecondTime[key4] = 0;
                        }
                        if (!clickCounters5SecondTime[key5]) {
                            clickCounters5SecondTime[key5] = 0;
                        }
                        if (!clickCounters6SecondTime[key6]) {
                            clickCounters6SecondTime[key6] = 0;
                        }
                        if (!clickCounters7SecondTime[key7]) {
                            clickCounters7SecondTime[key7] = 0;
                        }
                        clickCountersSecondTime[key]++;
                        clickCounters2SecondTime[key2]++;
                        clickCounters3SecondTime[key3]++;
                        clickCounters4SecondTime[key4]++;
                        clickCounters5SecondTime[key5]++;
                        clickCounters6SecondTime[key6]++;
                        clickCounters7SecondTime[key7]++;

                        if (!clickCounters[key]) {
                            clickCounters[key] = 0;
                        }
                        if (!clickCounters2[key2]) {
                            clickCounters2[key2] = 0;
                        }
                        if (!clickCounters3[key3]) {
                            clickCounters3[key3] = 0;
                        }
                        if (!clickCounters4[key4]) {
                            clickCounters4[key4] = 0;
                        }
                        if (!clickCounters5[key5]) {
                            clickCounters5[key5] = 0;
                        }
                        if (!clickCounters6[key6]) {
                            clickCounters6[key6] = 0;
                        }
                        if (!clickCounters7[key7]) {
                            clickCounters7[key7] = 0;
                        }
                        clickCounters[key]++;
                        clickCounters2[key2]++;
                        clickCounters3[key3]++;
                        clickCounters4[key4]++;
                        clickCounters5[key5]++;
                        clickCounters6[key6]++;
                        clickCounters7[key7]++;
                    }
                    
                    
                    let clickTime = performance.now();
                    let timeTaken = clickTime - loadTime;

                    // Create a key for the counters object
                    //tkey1 is for each specific topic's result layout combination (taking into account whether it's the first time or second time seeing the layout)
                    const tkey = `${searchQueryTopic}-${descriptionTypes}-${photoPresenceSimple}-${firstTimeSimple}`;
                    //tkey2 is for each specific topic's result layout combination
                    const tkey2 = `${searchQueryTopic}-${descriptionTypes}-${photoPresenceSimple}`;
                    //tkey3 is for each result layout combination, regardless of topic  (taking into account whether it's the first time or second time seeing the layout)
                    const tkey3 = `${descriptionTypes}-${photoPresenceSimple}-${firstTimeSimple}`;
                    //tkey4 is for each result layout combination, regardless of topic
                    const tkey4 = `${descriptionTypes}-${photoPresenceSimple}`;
                    //tkey5 is for each description type, regardless of photo presence and topic  (taking into account whether it's the first time or second time seeing the layout)
                    const tkey5 = `${descriptionTypes}-${firstTimeSimple}`;
                    //tkey6 is for each description type, regardless of photo presence and topic
                    const tkey6 = `${descriptionTypes}`; 
                    //tkey7 is for the photo presence, regardless of topic and description type
                    const tkey7 = `${photoPresenceSimple}`;

                    // If the counter for this key doesn't exist yet, initialize it
                    if (screens < 10){
                        
                        if (!timeCountersFirstTime[tkey]) {
                            timeCountersFirstTime[tkey] = 0;
                        }
                        if (!timeCounters2FirstTime[tkey2]) {
                            timeCounters2FirstTime[tkey2] = 0;
                        }
                        if (!timeCounters3FirstTime[tkey3]) {
                            timeCounters3FirstTime[tkey3] = 0;
                        }
                        if (!timeCounters4FirstTime[tkey4]) {
                            timeCounters4FirstTime[tkey4] = 0;
                        }
                        if (!timeCounters5FirstTime[tkey5]) {
                            timeCounters5FirstTime[tkey5] = 0;
                        }
                        if (!timeCounters6FirstTime[tkey6]) {
                            timeCounters6FirstTime[tkey6] = 0;
                        }
                        if (!timeCounters7FirstTime[tkey7]) {
                            timeCounters7FirstTime[tkey7] = 0;
                        }
                        timeCountersFirstTime[tkey]++;
                        timeCounters2FirstTime[tkey2]++;
                        timeCounters3FirstTime[tkey3]++;
                        timeCounters4FirstTime[tkey4]++;
                        timeCounters5FirstTime[tkey5]++;
                        timeCounters6FirstTime[tkey6]++;
                        timeCounters7FirstTime[tkey7]++;

                        if (!timeCounters[tkey]) {
                            timeCounters[tkey] = 0;
                        }
                        if (!timeCounters2[tkey2]) {
                            timeCounters2[tkey2] = 0;
                        }
                        if (!timeCounters3[tkey3]) {
                            timeCounters3[tkey3] = 0;
                        }
                        if (!timeCounters4[tkey4]) {
                            timeCounters4[tkey4] = 0;
                        }
                        if (!timeCounters5[tkey5]) {
                            timeCounters5[tkey5] = 0;
                        }
                        if (!timeCounters6[tkey6]) {
                            timeCounters6[tkey6] = 0;
                        }
                        if (!timeCounters7[tkey7]) {
                            timeCounters7[tkey7] = 0;
                        }
                        timeCounters[tkey]++;
                        timeCounters2[tkey2]++;
                        timeCounters3[tkey3]++;
                        timeCounters4[tkey4]++;
                        timeCounters5[tkey5]++;
                        timeCounters6[tkey6]++;
                        timeCounters7[tkey7]++;
                    } if (screens >= 10 && screens < 20) {
                        
                        if (!timeCountersSecondTime[tkey]) {
                            timeCountersSecondTime[tkey] = 0;
                        }
                        if (!timeCounters2SecondTime[tkey2]) {
                            timeCounters2SecondTime[tkey2] = 0;
                        }
                        if (!timeCounters3SecondTime[tkey3]) {
                            timeCounters3SecondTime[tkey3] = 0;
                        }
                        if (!timeCounters4SecondTime[tkey4]) {
                            timeCounters4SecondTime[tkey4] = 0;
                        }
                        if (!timeCounters5SecondTime[tkey5]) {
                            timeCounters5SecondTime[tkey5] = 0;
                        }
                        if (!timeCounters6SecondTime[tkey6]) {
                            timeCounters6SecondTime[tkey6] = 0;
                        }
                        if (!timeCounters7SecondTime[tkey7]) {
                            timeCounters7SecondTime[tkey7] = 0;
                        }
                        timeCountersSecondTime[tkey]++;
                        timeCounters2SecondTime[tkey2]++;
                        timeCounters3SecondTime[tkey3]++;
                        timeCounters4SecondTime[tkey4]++;
                        timeCounters5SecondTime[tkey5]++;
                        timeCounters6SecondTime[tkey6]++;
                        timeCounters7SecondTime[tkey7]++;

                        if (!timeCounters[tkey]) {
                            timeCounters[tkey] = 0;
                        }
                        if (!timeCounters2[tkey2]) {
                            timeCounters2[tkey2] = 0;
                        }
                        if (!timeCounters3[tkey3]) {
                            timeCounters3[tkey3] = 0;
                        }
                        if (!timeCounters4[tkey4]) {
                            timeCounters4[tkey4] = 0;
                        }
                        if (!timeCounters5[tkey5]) {
                            timeCounters5[tkey5] = 0;
                        }
                        if (!timeCounters6[tkey6]) {
                            timeCounters6[tkey6] = 0;
                        }
                        if (!timeCounters7[tkey7]) {
                            timeCounters7[tkey7] = 0;
                        }
                        timeCounters[tkey]++;
                        timeCounters2[tkey2]++;
                        timeCounters3[tkey3]++;
                        timeCounters4[tkey4]++;
                        timeCounters5[tkey5]++;
                        timeCounters6[tkey6]++;
                        timeCounters7[tkey7]++;
                    }

                    // OLD CODE: Add the time taken to the counters
                    // timeCounters[tkey] += timeTaken;
                    // timeCounters2[tkey2] += timeTaken;
                    // timeCounters3[tkey3] += timeTaken;
                    // timeCounters4[tkey4] += timeTaken;

                    // Reset the load time
                    loadTime = performance.now();
                    screens++;

                    console.log("screens: " + screens);

                    if (screens >= 20) {
                        autoDownload();
                        clickCounters[key] /= 4;
                        clickCounters2[key2] /= 4;
                        clickCounters3[key3] /= 4;
                        clickCounters4[key4] /= 4;
                        clickCounters5[key5] /= 4;
                        clickCounters6[key6] /= 4;
                        clickCounters7[key7] /= 4;
                        clickCountersFirstTime[key] /= 2;
                        clickCounters2FirstTime[key2] /= 2;
                        clickCounters3FirstTime[key3] /= 2;
                        clickCounters4FirstTime[key4] /= 2;
                        clickCounters5FirstTime[key5] /= 2;
                        clickCounters6FirstTime[key6] /= 2;
                        clickCounters7FirstTime[key7] /= 2;
                        clickCountersSecondTime[key] /= 2;
                        clickCounters2SecondTime[key2] /= 2;
                        clickCounters3SecondTime[key3] /= 2;
                        clickCounters4SecondTime[key4] /= 2;
                        clickCounters5SecondTime[key5] /= 2;
                        clickCounters6SecondTime[key6] /= 2;
                        clickCounters7SecondTime[key7] /= 2;
                        
                        timeCounters[tkey] /= 4;
                        timeCounters2[tkey2] /= 4;
                        timeCounters3[tkey3] /= 4;
                        timeCounters4[tkey4] /= 4;
                        timeCounters5[tkey5] /= 4;
                        timeCounters6[tkey6] /= 4;
                        timeCounters7[tkey7] /= 4;
                        timeCountersFirstTime[tkey] /= 2;
                        timeCounters2FirstTime[tkey2] /= 2;
                        timeCounters3FirstTime[tkey3] /= 2;
                        timeCounters4FirstTime[tkey4] /= 2;
                        timeCounters5FirstTime[tkey5] /= 2;
                        timeCounters6FirstTime[tkey6] /= 2;
                        timeCounters7FirstTime[tkey7] /= 2;
                        timeCountersSecondTime[tkey] /= 2;
                        timeCounters2SecondTime[tkey2] /= 2;
                        timeCounters3SecondTime[tkey3] /= 2;
                        timeCounters4SecondTime[tkey4] /= 2;
                        timeCounters5SecondTime[tkey5] /= 2;
                        timeCounters6SecondTime[tkey6] /= 2;
                        timeCounters7SecondTime[tkey7] /= 2;

                        alert("THE EXPERIMENT HAS ENDED! THANK YOU FOR YOUR PARTICIPATION!");
                        return;
                    }
                });
            });

            // Initialize Bootstrap tabs
            var tabList = document.querySelectorAll('[data-bs-toggle="tab"]');
            var tabListArray = [].slice.call(tabList);
            tabListArray.map(function (tab) {
                return new bootstrap.Tab(tab);
            });
        }
    
        // Function to append picture to a div
        function appendPicture(div, imageSrc) {
            let imgContainer = document.createElement('div');
            imgContainer.style.width = '100px'; // Set the width of the container
            imgContainer.style.height = '100px'; // Set the height of the container
            imgContainer.style.overflow = 'hidden'; // Hide the parts of the image that don't fit in the container
            imgContainer.style.marginLeft = 'auto'; // Align the image container to the right
            imgContainer.style.borderRadius = '15px';

            let img = document.createElement('img');
            img.src = imageSrc;
            img.style.width = '100%'; // Make the image fill the container
            img.style.height = '100%'; // Make the image fill the container
            img.style.objectFit = 'cover'; // Make the image cover the container while maintaining its aspect ratio

            imgContainer.appendChild(img); // Append the image to the container
            div.appendChild(imgContainer); // Append the container to the div
        }
        
        data.results.sort(() => Math.random() - 0.5);
        displayData();

        // Add function to automatically download data after 10 screens
        function autoDownload() {
            let data = '"Column One","Column Two","Column Three"';
            // var headerData = ['Exact search result layout', 'Num of clicks', 'Avg time taken to choose (in ms)', 'Layout and photo combination', 'Num of clicks', 'Avg time taken to choose (in ms)', 'Layout only', 'Num of clicks', 'Avg time taken to choose (in ms)',	'Presence of photo', 'Num of clicks', 'Avg time taken to choose (in ms)'];
            // Convert the data to CSV
            let csv = 'data:text/csv;charset=utf-8,';
            //csv += headerData.join(',') + '\n'; // Adds the headers of each column to the CSV files

            //TODO: CHANGE OLD CODE TO TAKE INTO ACCOUNT FIRST AND SECOND TIME

            // OVERALL DATA
            csv += 'Overall layout properties' + ',';
            csv += Object.keys(clickCounters2).join(',') + ',';
            csv += Object.keys(clickCounters4).join(',') + ',';
            csv += Object.keys(clickCounters6).join(',') + ',';
            csv += Object.keys(clickCounters7).join(',') + '\n';
            
            csv += 'Overall number of clicks' + ',';
            csv += Object.values(clickCounters2).join(',') + ',';
            csv += Object.values(clickCounters4).join(',') + ',';
            csv += Object.values(clickCounters6).join(',') + ',';
            csv += Object.values(clickCounters7).join(',') + '\n';

            csv += 'Overall accumulated time taken to choose (in ms)' + ',';
            csv += Object.values(timeCounters2).join(',') + ',';
            csv += Object.values(timeCounters4).join(',') + ',';
            csv += Object.values(timeCounters6).join(',') + ',';
            csv += Object.values(timeCounters7).join(',') + '\n' + '\n';

            //FIRST TIME APPEARANCE DATA

            csv += 'First-time appearance layout properties' + ',';
            csv += Object.keys(clickCountersFirstTime).join(',') + ',';
            csv += Object.keys(clickCounters2FirstTime).join(',') + ',';
            csv += Object.keys(clickCounters3FirstTime).join(',') + ',';
            csv += Object.keys(clickCounters4FirstTime).join(',') + ',';
            csv += Object.keys(clickCounters5FirstTime).join(',') + ',';
            csv += Object.keys(clickCounters6FirstTime).join(',') + ',';
            csv += Object.keys(clickCounters7FirstTime).join(',') + '\n';
            
            csv += 'First-time appearance number of clicks' + ',';
            csv += Object.values(clickCountersFirstTime).join(',') + ',';
            csv += Object.values(clickCounters2FirstTime).join(',') + ',';
            csv += Object.values(clickCounters3FirstTime).join(',') + ',';
            csv += Object.values(clickCounters4FirstTime).join(',') + ',';
            csv += Object.values(clickCounters5FirstTime).join(',') + ',';
            csv += Object.values(clickCounters6FirstTime).join(',') + ',';
            csv += Object.values(clickCounters7FirstTime).join(',') + '\n';

            csv += 'First-time appearance accumulated time taken to choose (in ms)' + ',';
            csv += Object.values(timeCountersFirstTime).join(',') + ',';
            csv += Object.values(timeCounters2FirstTime).join(',') + ',';
            csv += Object.values(timeCounters3FirstTime).join(',') + ',';
            csv += Object.values(timeCounters4FirstTime).join(',') + ',';
            csv += Object.values(timeCounters5FirstTime).join(',') + ',';
            csv += Object.values(timeCounters6FirstTime).join(',') + ',';
            csv += Object.values(timeCounters7FirstTime).join(',') + '\n' + '\n';

            //SECOND TIME APPEARANCE DATA

            csv += 'Second-time appearance layout properties' + ',';
            csv += Object.keys(clickCountersSecondTime).join(',') + ',';
            csv += Object.keys(clickCounters2SecondTime).join(',') + ',';
            csv += Object.keys(clickCounters3SecondTime).join(',') + ',';
            csv += Object.keys(clickCounters4SecondTime).join(',') + ',';
            csv += Object.keys(clickCounters5SecondTime).join(',') + ',';
            csv += Object.keys(clickCounters6SecondTime).join(',') + ',';
            csv += Object.keys(clickCounters7SecondTime).join(',') + '\n';
            
            csv += 'Second-time appearance number of clicks' + ',';
            csv += Object.values(clickCountersSecondTime).join(',') + ',';
            csv += Object.values(clickCounters2SecondTime).join(',') + ',';
            csv += Object.values(clickCounters3SecondTime).join(',') + ',';
            csv += Object.values(clickCounters4SecondTime).join(',') + ',';
            csv += Object.values(clickCounters5SecondTime).join(',') + ',';
            csv += Object.values(clickCounters6SecondTime).join(',') + ',';
            csv += Object.values(clickCounters7SecondTime).join(',') + '\n';

            csv += 'Second-time appearance accumulated time taken to choose (in ms)' + ',';
            csv += Object.values(timeCountersSecondTime).join(',') + ',';
            csv += Object.values(timeCounters2SecondTime).join(',') + ',';
            csv += Object.values(timeCounters3SecondTime).join(',') + ',';
            csv += Object.values(timeCounters4SecondTime).join(',') + ',';
            csv += Object.values(timeCounters5SecondTime).join(',') + ',';
            csv += Object.values(timeCounters6SecondTime).join(',') + ',';
            csv += Object.values(timeCounters7SecondTime).join(',') + '\n' + '\n';

            // Small comment: Can/might/should add average time taken to choose

            // Create a link and download the CSV
            const encodedUri = encodeURI(csv);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'data.csv');
            document.body.appendChild(link);
            link.click();
        }

        // Helper function to shuffle an array
        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }
    </script>
    </body>
</html>